# n8n 本地安装指南

## 📋 前置要求

### 💻 系统要求
- **操作系统**：Windows 10/11、macOS 10.15+、Ubuntu 18.04+
- **内存**：至少 4GB RAM（推荐 8GB+）
- **存储**：至少 2GB 可用空间
- **网络**：稳定的互联网连接

### 🛠️ 必需软件
- **Node.js**：版本 18.0.0 或更高
- **npm**：版本 8.0.0 或更高
- **Git**：用于版本控制（可选）

## 🚀 安装方法一：npm 安装（推荐）

### 1. 安装 Node.js
```bash
# 检查 Node.js 版本
node --version

# 检查 npm 版本
npm --version
```

如果未安装，请访问 [Node.js 官网](https://nodejs.org/) 下载安装。

### 2. 全局安装 n8n
```bash
# 安装 n8n
npm install n8n -g

# 验证安装
n8n --version
```

### 3. 启动 n8n
```bash
# 启动 n8n
n8n start

# 或者指定端口启动
n8n start --port 5678
```

### 4. 访问界面
打开浏览器访问：`http://localhost:5678`

## 🐳 安装方法二：Docker 安装

### 1. 安装 Docker
- **Windows/macOS**：下载 [Docker Desktop](https://www.docker.com/products/docker-desktop)
- **Linux**：使用包管理器安装 Docker

### 2. 拉取镜像
```bash
# 拉取最新版本的 n8n 镜像
docker pull n8nio/n8n:latest
```

### 3. 运行容器
```bash
# 简单运行
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  n8nio/n8n:latest

# 后台运行
docker run -d \
  --name n8n \
  -p 5678:5678 \
  n8nio/n8n:latest
```

### 4. 访问界面
打开浏览器访问：`http://localhost:5678`

## 🔧 安装方法三：源码安装

### 1. 克隆仓库
```bash
# 克隆 n8n 源码
git clone https://github.com/n8n-io/n8n.git
cd n8n
```

### 2. 安装依赖
```bash
# 安装依赖
npm install

# 构建项目
npm run build
```

### 3. 启动开发环境
```bash
# 启动开发服务器
npm run dev

# 或者启动生产版本
npm start
```

## ⚙️ 基础配置

### 1. 环境变量配置
创建 `.env` 文件：
```bash
# 基础配置
N8N_HOST=localhost
N8N_PORT=5678
N8N_PROTOCOL=http

# 数据库配置（默认使用 SQLite）
DB_TYPE=sqlite
DB_SQLITE_DATABASE=./n8n.db

# 安全配置
N8N_ENCRYPTION_KEY=your-secret-key-here

# 时区配置
GENERIC_TIMEZONE=Asia/Shanghai
```

### 2. 配置文件
创建 `~/.n8n/config.json`：
```json
{
  "database": {
    "type": "sqlite",
    "database": "./n8n.db"
  },
  "security": {
    "encryptionKey": "your-secret-key-here"
  },
  "timezone": "Asia/Shanghai"
}
```

## 🗄️ 数据库配置

### SQLite（默认，适合开发）
```bash
# 无需额外配置，n8n 会自动创建数据库文件
DB_TYPE=sqlite
DB_SQLITE_DATABASE=./n8n.db
```

### PostgreSQL（推荐生产环境）
```bash
# 安装 PostgreSQL
# Ubuntu/Debian
sudo apt-get install postgresql postgresql-contrib

# macOS
brew install postgresql

# 创建数据库和用户
sudo -u postgres psql
CREATE DATABASE n8n;
CREATE USER n8n WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE n8n TO n8n;
\q

# 配置环境变量
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=localhost
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=n8n
DB_POSTGRESDB_PASSWORD=your_password
```

### MySQL
```bash
# 安装 MySQL
# Ubuntu/Debian
sudo apt-get install mysql-server

# 创建数据库和用户
mysql -u root -p
CREATE DATABASE n8n;
CREATE USER 'n8n'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON n8n.* TO 'n8n'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# 配置环境变量
DB_TYPE=mysqldb
DB_MYSQLDB_HOST=localhost
DB_MYSQLDB_PORT=3306
DB_MYSQLDB_DATABASE=n8n
DB_MYSQLDB_USER=n8n
DB_MYSQLDB_PASSWORD=your_password
```

## 🔐 安全配置

### 1. 基本认证
```bash
# 启用基本认证
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your_secure_password
```

### 2. 加密密钥
```bash
# 生成强加密密钥
N8N_ENCRYPTION_KEY=your-32-character-encryption-key
```

### 3. 用户管理
```bash
# 禁用用户管理（单用户模式）
N8N_USER_MANAGEMENT_DISABLED=true

# 启用用户管理（多用户模式）
N8N_USER_MANAGEMENT_DISABLED=false
```

## 📁 文件存储配置

### 1. 本地存储
```bash
# 默认存储在用户目录
# Windows: C:\Users\YourUsername\.n8n
# macOS: /Users/YourUsername/.n8n
# Linux: /home/YourUsername/.n8n
```

### 2. 自定义存储路径
```bash
# 设置自定义存储路径
N8N_USER_FOLDER=/path/to/your/n8n/data
```

### 3. 外部存储
```bash
# 使用外部存储服务（如 S3、Google Cloud Storage）
N8N_EXTERNAL_FILES_ENABLED=true
N8N_EXTERNAL_FILES_BACKEND=s3
N8N_EXTERNAL_FILES_S3_BUCKET=your-bucket-name
N8N_EXTERNAL_FILES_S3_ACCESS_KEY_ID=your-access-key
N8N_EXTERNAL_FILES_S3_SECRET_ACCESS_KEY=your-secret-key
```

## 🚀 启动和停止

### 启动服务
```bash
# 前台启动（开发环境）
n8n start

# 后台启动（生产环境）
n8n start --daemon

# 指定配置文件启动
n8n start --config=/path/to/config.json
```

### 停止服务
```bash
# 如果在前台运行，按 Ctrl+C
# 如果在后台运行
n8n stop

# 或者查找进程并杀死
ps aux | grep n8n
kill -9 <process_id>
```

## 🔍 故障排除

### 常见问题

#### 1. 端口被占用
```bash
# 检查端口占用
netstat -tulpn | grep 5678

# 使用其他端口
n8n start --port 5679
```

#### 2. 权限问题
```bash
# Linux/macOS 权限问题
sudo chown -R $USER:$USER ~/.n8n
chmod -R 755 ~/.n8n
```

#### 3. 数据库连接失败
```bash
# 检查数据库服务状态
# PostgreSQL
sudo systemctl status postgresql

# MySQL
sudo systemctl status mysql

# 检查连接
psql -h localhost -U n8n -d n8n
mysql -h localhost -u n8n -p n8n
```

#### 4. 内存不足
```bash
# 增加 Node.js 内存限制
export NODE_OPTIONS="--max-old-space-size=4096"
n8n start
```

### 日志查看
```bash
# 查看 n8n 日志
tail -f ~/.n8n/logs/n8n.log

# 查看系统日志
journalctl -u n8n -f
```

## 📚 下一步

安装完成后，您可以：

1. **创建第一个工作流**：参考 `04_节点详解` 章节
2. **学习节点使用**：从简单的触发节点开始
3. **配置第三方集成**：连接您常用的服务
4. **部署到生产环境**：参考 `03_环境部署` 章节

## 🆘 获取帮助

如果遇到问题：

1. **查看官方文档**：[n8n.io/docs](https://n8n.io/docs)
2. **搜索 GitHub Issues**：[github.com/n8n-io/n8n/issues](https://github.com/n8n-io/n8n/issues)
3. **加入社区讨论**：[n8n.io/community](https://n8n.io/community)
4. **查看本教程**：`06_调试与排错` 章节

---

**恭喜！您已经成功安装了 n8n。现在可以开始创建您的第一个自动化工作流了！** 🎉
