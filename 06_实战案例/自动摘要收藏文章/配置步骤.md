# 自动摘要收藏文章 - 配置步骤

## 🎯 项目概述

这个工作流将自动监控您的 RSS 阅读器（如 Inoreader），当有新文章收藏时，自动使用 AI 生成摘要，并保存到 Notion 数据库中，实现**智能阅读管理**。

## 🔄 工作流流程

```
Inoreader RSS → 过滤收藏文章 → AI 摘要生成 → 保存到 Notion → 发送通知
```

## 📋 前置准备

### 1. 获取 API 密钥

#### Inoreader API
1. 访问 [Inoreader 开发者页面](https://www.inoreader.com/developers)
2. 创建应用获取 `App ID` 和 `App Key`
3. 记录您的用户 ID（在 Inoreader 设置中查看）

#### OpenAI API
1. 访问 [OpenAI API 页面](https://platform.openai.com/api-keys)
2. 创建新的 API 密钥
3. 确保账户有足够的余额

#### Notion API
1. 访问 [Notion 开发者页面](https://www.notion.so/my-integrations)
2. 创建新的集成
3. 获取 `Internal Integration Token`
4. 在目标数据库中分享权限给集成

### 2. 创建 Notion 数据库

在 Notion 中创建新的数据库，包含以下字段：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| 标题 | Title | 文章标题 |
| 链接 | URL | 原文链接 |
| 作者 | Text | 文章作者 |
| 发布时间 | Date | 发布时间 |
| 摘要 | Text | AI 生成的摘要 |
| 关键词 | Multi-select | 提取的关键词 |
| 收藏时间 | Date | 收藏时间 |
| 状态 | Select | 处理状态 |

## 🚀 详细配置步骤

### 步骤 1：创建 Inoreader 触发节点

#### 1.1 添加 Inoreader 节点
- 节点类型：`Inoreader`
- 操作：`Get All Articles`
- 认证：使用您的 Inoreader 凭据

#### 1.2 配置参数
```json
{
  "authentication": "inoreaderOAuth2",
  "operation": "getAllArticles",
  "streamId": "user/-/state/com.google/starred",
  "count": 10,
  "includeDeleted": false,
  "includeAttachments": false
}
```

#### 1.3 设置触发器
- 触发模式：`Every 30 minutes`
- 或者使用 `Schedule` 节点设置定时执行

### 步骤 2：过滤收藏文章

#### 2.1 添加 IF 节点
- 节点类型：`IF`
- 条件：检查文章是否为新收藏

#### 2.2 配置过滤条件
```javascript
// 检查文章是否已处理过
const articleId = $json.id;
const existingArticles = await getNotionArticles(); // 从 Notion 获取已存在的文章

return !existingArticles.some(article => article.articleId === articleId);
```

#### 2.3 设置输出
- 如果条件为真：继续处理
- 如果条件为假：跳过（可选：记录日志）

### 步骤 3：数据预处理

#### 3.1 添加 Code 节点
- 节点类型：`Code`
- 语言：JavaScript

#### 3.2 编写预处理代码
```javascript
// 提取文章信息
const articles = $input.all();

const processedArticles = articles.map(article => {
  return {
    title: article.title,
    link: article.link,
    author: article.author || 'Unknown',
    publishedDate: article.published,
    content: article.content || article.summary,
    articleId: article.id,
    feedTitle: article.feedTitle
  };
});

// 过滤掉内容过短的文章
const validArticles = processedArticles.filter(article => 
  article.content && article.content.length > 100
);

return validArticles;
```

### 步骤 4：AI 摘要生成

#### 4.1 添加 OpenAI 节点
- 节点类型：`OpenAI`
- 操作：`Chat`
- 模型：`gpt-3.5-turbo`

#### 4.2 配置 AI 参数
```json
{
  "authentication": "openAiApi",
  "operation": "chat",
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "你是一个专业的文章摘要专家。请为给定的文章生成简洁、准确的摘要，并提取3-5个关键词。"
    },
    {
      "role": "user",
      "content": "请为以下文章生成摘要和关键词：\n\n标题：{{ $json.title }}\n\n内容：{{ $json.content }}\n\n请按以下格式返回：\n摘要：[200字以内的摘要]\n关键词：[关键词1, 关键词2, 关键词3]"
    }
  ],
  "options": {
    "temperature": 0.7,
    "maxTokens": 500
  }
}
```

#### 4.3 处理 AI 响应
```javascript
// 解析 AI 响应
const aiResponse = $json.choices[0].message.content;

// 提取摘要和关键词
const summaryMatch = aiResponse.match(/摘要：(.+?)(?=\n|关键词：|$)/s);
const keywordsMatch = aiResponse.match(/关键词：\[(.+?)\]/);

const summary = summaryMatch ? summaryMatch[1].trim() : '';
const keywords = keywordsMatch ? 
  keywordsMatch[1].split(',').map(k => k.trim()) : [];

return {
  ...$input.first().json,
  summary: summary,
  keywords: keywords,
  aiProcessed: true
};
```

### 步骤 5：保存到 Notion

#### 5.1 添加 Notion 节点
- 节点类型：`Notion`
- 操作：`Create Page`
- 数据库：选择您创建的数据库

#### 5.2 配置页面属性
```json
{
  "authentication": "notionApi",
  "operation": "createPage",
  "databaseId": "your-database-id",
  "properties": {
    "标题": {
      "title": [
        {
          "text": {
            "content": "{{ $json.title }}"
          }
        }
      ]
    },
    "链接": {
      "url": "{{ $json.link }}"
    },
    "作者": {
      "rich_text": [
        {
          "text": {
            "content": "{{ $json.author }}"
          }
        }
      ]
    },
    "发布时间": {
      "date": {
        "start": "{{ $json.publishedDate }}"
      }
    },
    "摘要": {
      "rich_text": [
        {
          "text": {
            "content": "{{ $json.summary }}"
          }
        }
      ]
    },
    "关键词": {
      "multi_select": "{{ $json.keywords.map(keyword => ({ name: keyword })) }}"
    },
    "收藏时间": {
      "date": {
        "start": "{{ new Date().toISOString() }}"
      }
    },
    "状态": {
      "select": {
        "name": "已处理"
      }
    }
  }
}
```

### 步骤 6：错误处理和通知

#### 6.1 添加错误处理
- 在每个关键节点后添加 `Error Trigger` 节点
- 配置错误处理逻辑

#### 6.2 添加通知节点
```javascript
// 成功通知
const successMessage = `成功处理 ${$input.all().length} 篇文章`;
console.log(successMessage);

// 可选：发送到企业微信或邮件
return {
  message: successMessage,
  processedCount: $input.all().length,
  timestamp: new Date().toISOString()
};
```

## ⚙️ 高级配置

### 1. 批量处理优化
```javascript
// 分批处理文章，避免 API 限制
const batchSize = 5;
const articles = $input.all();
const batches = [];

for (let i = 0; i < articles.length; i += batchSize) {
  batches.push(articles.slice(i, i + batchSize));
}

return batches;
```

### 2. 智能去重
```javascript
// 使用文章标题和链接进行去重
const seen = new Set();
const uniqueArticles = $input.all().filter(article => {
  const key = `${article.title}-${article.link}`;
  if (seen.has(key)) {
    return false;
  }
  seen.add(key);
  return true;
});

return uniqueArticles;
```

### 3. 内容质量过滤
```javascript
// 过滤低质量内容
const qualityArticles = $input.all().filter(article => {
  // 内容长度检查
  if (!article.content || article.content.length < 200) {
    return false;
  }
  
  // 标题质量检查
  if (article.title.length < 10 || article.title.length > 100) {
    return false;
  }
  
  // 排除广告和垃圾内容
  const spamKeywords = ['广告', '推广', '点击', '赚钱'];
  if (spamKeywords.some(keyword => 
    article.title.includes(keyword) || article.content.includes(keyword)
  )) {
    return false;
  }
  
  return true;
});

return qualityArticles;
```

## 🔍 测试和调试

### 1. 测试工作流
1. **手动触发**：点击"执行工作流"按钮
2. **检查日志**：查看每个节点的执行状态
3. **验证数据**：检查 Notion 数据库中的数据

### 2. 常见问题排查
- **API 限制**：检查 API 调用次数和频率
- **认证问题**：验证 API 密钥和权限
- **数据格式**：检查数据结构和字段映射
- **网络问题**：检查网络连接和防火墙设置

### 3. 性能优化
- **并发控制**：限制同时处理的文章数量
- **缓存机制**：缓存已处理的文章信息
- **错误重试**：配置失败重试机制

## 📊 监控和维护

### 1. 执行统计
- 监控工作流执行频率
- 统计处理的文章数量
- 跟踪 AI 调用成本

### 2. 质量评估
- 定期检查摘要质量
- 收集用户反馈
- 优化 AI 提示词

### 3. 系统维护
- 定期更新 API 密钥
- 监控系统资源使用
- 备份重要配置

## 🎯 扩展功能

### 1. 多语言支持
```javascript
// 检测文章语言并选择相应的 AI 模型
const language = detectLanguage(article.content);
const model = language === 'zh' ? 'gpt-3.5-turbo' : 'gpt-4';
```

### 2. 情感分析
```javascript
// 添加情感分析功能
const sentiment = await analyzeSentiment(article.content);
return {
  ...article,
  sentiment: sentiment.score,
  sentimentLabel: sentiment.label
};
```

### 3. 分类标签
```javascript
// 自动分类文章
const category = await classifyArticle(article.content);
return {
  ...article,
  category: category
};
```

## 🎉 总结

通过这个工作流，您可以：

1. **自动化阅读管理**：自动收集和处理感兴趣的文章
2. **AI 智能摘要**：快速获取文章核心内容
3. **知识库建设**：在 Notion 中建立个人知识库
4. **效率提升**：节省手动整理文章的时间

**下一步**：根据实际使用情况优化工作流，添加更多智能功能，如个性化推荐、阅读进度跟踪等。
