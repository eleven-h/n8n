# 🧪 学会单步调试与撰写测试用例

在制作 n8n 工作流的过程中，我们经常强调"设置完一个节点之后一定要测试一下"。这个章节就来详细聊聊单步调试和测试用例的重要性，以及如何在实际操作中运用这些技巧。

---

## 单步调试为什么重要？

### 什么是单步调试？

单步调试原本是编程里的概念，就是一行一行地执行代码，观察每一步的执行情况。在 n8n 里，我们可以把"单步调试"理解为"单个节点调试"——就是看看每个节点能不能正常工作。

因为 n8n 的大部分节点都是现成的，我们改不了，所以只需要关心：输入什么数据，输出什么结果，符合预期就说明这个节点没问题。

### 为什么要做单步调试？

即使是最简单的 n8n 程序，通常也有 5-6 个步骤。强烈建议在制作工作流的时候进行单步调试，原因有三个：

**1. 避免后期排查困难**
- 如果程序步骤很多，出错了从头检查会很麻烦
- 如果每个节点都测试过了，连在一起基本就能成功
- 就像搭积木，每块都确认没问题，搭出来的房子才稳固

**2. 优化 AI 提示词**
- 用大模型的时候，没有完美的提示词，只有不断测试和调整出来的好提示词
- 通过单步测试，你能看到 AI 的实际输出，然后调整提示词让它更准确
- 吴恩达的 Prompt 课程也强调过这一点

**3. 获得成就感**
- 每个步骤成功执行，都能给你一些快乐
- 在低代码配置过程中会遇到很多挫折，多给自己一些奖励很有必要
- 有时候中间步骤的结果已经能满足需求了，就可以直接结束工作

### 单步调试的核心工具

单步调试主要用到两个功能：

**1. Test Step（测试步骤）**
- 点击节点上的"Test Step"按钮
- 可以单独测试这个节点，不用运行整个工作流

**2. OUTPUT 窗口**
- 显示节点的执行结果
- 如果出错了，也会显示错误信息
- 看不懂错误码的话，可以问 ChatGPT 解释

---

## 测试用例为什么重要？

### 为什么需要测试用例？

我们为什么要用 n8n 写自动化程序？因为有很多重复性、批量性的工作，想用机器替代人力。

但是问题来了：怎么保证现在测试成功的程序，以后不管它的时候也能成功？怎么保证处理当前数据成功，处理别的数据也能成功？

这就需要测试用例了。

### 什么是测试用例？

测试用例就是用来验证程序是否按预期工作的具体例子。在 n8n 里，因为所有节点都是"输入-处理-输出"的模式，所以测试用例就是：**输入 A，输出应该是 A1**。

### 什么时候需要测试用例？

不是每个节点都需要测试用例，因为 n8n 的大部分节点都是现成的，已经测试过了。但有两种情况例外：

**1. 大量数据处理的场景**
- 数据源质量可能有问题，这很常见
- 比如某个字段可能为空，或者枚举值超出预期
- 程序可能会因为这些意外情况中断
- 需要做柔性设计，考虑各种边界情况

**2. 使用大模型的场景**
- 大模型有幻觉问题，输出不稳定
- 如果要让 AI 做分类、打标签等工作，最好准备 10-20 个案例
- 先人工标注一遍，再让 AI 标注，对比结果调整提示词
- 实际经验：AI 标注正确率能达到 90% 就很不错了

### 测试用例的局限性

有人可能会问：即使程序通过了所有测试用例，是不是也不代表万无一失？

是的，所有测试用例都有局限性。但是因为程序通过了所有测试，我们就可以认为它是正确的。

就像看到一个动物，如果它看起来像大黄、游泳像大黄、叫声像大黄，那它可能就是只大黄。你不能因为怀疑它是另一个品种的动物，就特意用 X 光照一下，这样很不经济。

通过了所有的测试用例，我们就可以认为它是正确的。

---

## 实际操作建议

### 单步调试的步骤
1. 配置好一个节点后，立即点击"Test Step"
2. 查看 OUTPUT 窗口的结果
3. 如果出错，分析错误信息，调整配置
4. 重复直到节点正常工作
5. 再配置下一个节点

### 测试用例的设计
1. **正常情况**：设计几个典型的输入输出例子
2. **边界情况**：空值、最大值、最小值等
3. **异常情况**：格式错误、类型不匹配等
4. **AI 场景**：准备多样化的样本，覆盖不同情况

### 记录和文档化
- 把测试用例记录下来
- 记录常见错误和解决方案
- 这样下次遇到类似问题就能快速解决

---

## 总结

单步调试和测试用例是 n8n 工作流开发中非常重要的技能：

- **单步调试**：确保每个节点都能正常工作，避免后期排查困难
- **测试用例**：确保程序在各种情况下都能稳定运行

掌握这些技巧，你就能更自信地构建可靠的自动化工作流，减少调试时间，提高开发效率。

记住：**慢工出细活，测试不嫌多**。花在测试上的时间，最终会为你节省更多的时间。
